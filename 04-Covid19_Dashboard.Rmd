---
title: "04-Covid19_Dashboard"
css: style.css
---

# COVID 19 Dashboard for Balkan countries*

::: {.infobox .graph data-latex="{graph}"}
[Here you go directly to the dashboard](https://mirza-mujanovic.shinyapps.io/covid-19/)
:::

## Data

```{r,echo=FALSE,error=FALSE,message=FALSE,warning=FALSE}
library(reshape2)
library(ggplot2)
library(dplyr)
library(rvest)
library(plotly)
library(scales)
library(wesanderson)    
library(shiny)
library(twitteR)
library(rtweet)
library(sentimentr)
library(tidyverse)
library(purrr)
library(devtools)
library(textdata)
library(ggplot2)
library(ggthemes)
library(xml2)
library(qdap)
library(wordcloud)
library(RColorBrewer)
library(NLP)
library(tm)
library(tidytext)
library(dplyr)
library(tidyr)
library(ggthemes)
library(plotly)
library(tidyverse)
library(broom)
library(remotes)
library(janeaustenr)
library(qdap)
library(glue)
library(syuzhet)
```


```{r, error=FALSE,message=FALSE,warning=FALSE}
# Github 
covid19_confirmed_git <-"https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_global.csv"
covid19_confirmed_git <- read_csv(url(covid19_confirmed_git))

# Worldometer
codivid19_all <- "https://www.worldometers.info/coronavirus/"
main_table <- codivid19_all%>%
  xml2::read_html()%>%
  html_nodes(xpath='//*[@id="main_table_countries_today"]') %>%
  html_table()
main_table <- as.data.frame(main_table)
```


```{r, error=FALSE,message=FALSE,warning=FALSE,echo=FALSE}
## Filtering data for Balkan countries (plus Italy and Austria)
balkan <- filter(main_table,Country.Other == "Bosnia and Herzegovina" | Country.Other == "Italy" | Country.Other == "Croatia" | Country.Other == "Serbia"  | Country.Other == "Montenegro"  | Country.Other == "Slovenia"  | Country.Other == "Austria"  | Country.Other == "North Macedonia" | Country.Other == "Greece")
balkan$TotalCases<-gsub(",", "", balkan$TotalCases)
balkan$NewCases<-gsub(",", "", balkan$NewCases)
balkan$TotalRecovered<-gsub(",", "", balkan$TotalRecovered)
balkan$TotalDeaths<-gsub(",", "", balkan$TotalDeaths)
balkan$TotalRecovered <- as.numeric(balkan$TotalRecovered)
balkan$TotalDeaths <- as.numeric(balkan$TotalDeaths)
balkan$TotalCases<-as.numeric(balkan$TotalCases)
balkan$NewCases <- as.numeric(balkan$NewCases)


```

## Curve of confirmed cases 

The graph shows the number of confirmed cases by the last date shown.Updates daily at around 23:59 UTC.

```{r,warning=FALSE,error=FALSE,message=FALSE,fig.width=8,echo=FALSE}
# Curve of confirmed cases----
columns <- colnames(covid19_confirmed_git)[5:ncol(covid19_confirmed_git)]
final <-as.data.frame(pivot_longer(covid19_confirmed_git, cols = columns, names_to = "Year", values_to = "Confirmed"))
final$Year <- as.Date.character(final$Year,"%m/%d/%y")
colnames(final) <- c("Province","Country","Lat","Long","Year","Confirmed") 
filter <- filter(final, Country == "Bosnia and Herzegovina" | Country == "Italy" | Country == "Croatia" | Country == "Serbia"  | Country == "Slovenia"  | Country == "Montenegro"  | Country == "Austria" | Country == "North Macedonia" | Country == "Greece")
p <-ggplot(filter, aes(x = Year, y = Confirmed)) + 
  geom_line(aes(color = Country), size = 1) +
  scale_color_brewer(palette="Set1")+
  theme(legend.title = element_text(size = 6),legend.text = element_text(size = 6),  
  # Remove panel background
  panel.background = element_blank(),
  # Add axis line
  axis.line = element_line(colour = "grey"))+
  scale_y_log10(labels = comma)+
  scale_x_date(date_labels = "%b-%d", date_breaks = "4 week")+
  ylab("Confirmed cases")+
  labs(caption="Data source: https://github.com/CSSEGISandData/COVID-19")
ggplotly(p)
```

## Deaths vs Recovered 

The bar chart shows the total number of recovered people in comparison to the total number of death cases. Updates daily at around 23:59 UTC.

```{r, error=FALSE,message=FALSE,warning=FALSE,echo=FALSE}
options(scipen = 9999)
p <- ggplot(balkan) +
  geom_segment( aes(x=Country.Other, xend=Country.Other, y=TotalRecovered, yend=TotalDeaths), color="grey") +
  geom_point( aes(x=Country.Other, y=TotalRecovered), color=rgb(0.2,0.7,0.1,0.5), size=3 ) +
  geom_point( aes(x=Country.Other, y=TotalDeaths), color=rgb(0.7,0.2,0.1,0.5), size=3 ) + coord_flip()+
  scale_y_log10()+
  theme_minimal() +
  theme(
  legend.position = "none",
  panel.background = element_blank(),
  panel.grid = element_blank(),
  axis.line = element_line(colour = "grey")) +
    xlab("") +
    ylab("Number of cases")+
    ggtitle(label = "Death vs Recovered")
ggplotly(p)
```

## Total cases vs new cases

The bar chart shows the total number of cases in comparison to the number of new cases being constantly reported.

```{r, error=FALSE,message=FALSE,warning=FALSE,echo=FALSE}
# Total cases vs new cases
total_and_new <- melt(balkan[,c("TotalCases","NewCases","Country.Other")])
p <- ggplot(total_and_new, aes(x=Country.Other, y=value, fill=variable)) +
  geom_bar(stat='identity', position='dodge', color="black" ,aes(text=paste("Country: ",Country.Other, "\n", variable,":",value, sep=""))) +
  scale_fill_brewer(palette = "Paired")+
  scale_y_continuous(labels=comma, trans = "log10") +
  ylab("Number of cases")+
  xlab("")+
  ggtitle(label = "Total cases vs New cases") +
  theme_minimal()+
  labs(title = "",fill="" )+
  coord_flip()
  
ggplotly(p, tooltip = "text")
```

## Hospitalization

```{r,echo=FALSE,message=FALSE,warning=FALSE,error=FALSE,fig.show='asis'}
hospitalization <- read.csv("data/Hospitalization_all_locs.csv")
hospitalization$X <- NULL

columns <- colnames(hospitalization)[3:ncol(hospitalization)]
pivot_hospitalization<-as.data.frame(pivot_longer(hospitalization, cols = columns))
colnames(pivot_hospitalization) <- c("Country","Date","Variable","Value") 
pivot_hospitalization.mean.EU <- filter(pivot_hospitalization,
                                          Variable == "admis_mean"|
                                          Variable == "allbed_mean"|
                                          Variable == "bedover_mean"|
                                          Variable == "ICUbed_mean"|
                                          Variable == "icuover_mean"|
                                          Variable == "invVen_mean"|
                                          Variable == "newICU_mean")
pivot_hospitalization.mean.EU <- filter(pivot_hospitalization.mean.EU, Value > 0)
pivot_hospitalization.mean.EU$Date <- as.Date(as.POSIXct(pivot_hospitalization.mean.EU$Date,"%Y%M%D"))
```

### Croatia

```{r,echo=FALSE,message=FALSE,warning=FALSE,error=FALSE,fig.show='asis'}
#Croatia
pivot_hospitalization.mean.cro <- filter(pivot_hospitalization.mean.EU,Country == "Croatia")

p <- ggplot(pivot_hospitalization.mean.cro,aes(x=Date,y=Value)) +
  geom_line(aes(color=Variable), size=1) +
  scale_color_brewer(palette = "Set1") +
  theme(legend.title = element_text(size = 6),legend.text = element_text(size = 6),  
  panel.background = element_blank(),
  axis.line = element_line(colour = "grey"))+
  scale_y_sqrt()+
  ggtitle(label = "Hospitalisation numbers in Croatia")+
  scale_x_date(date_labels = "%B-%d", date_breaks = "5 week")+
  ylab("Mean")+
  labs(caption="Data source: ")

ggplotly(p)
```

### Slovenia 

```{r,echo=FALSE,message=FALSE,warning=FALSE,error=FALSE,fig.show='asis'}
#Slovenia
pivot_hospitalization.mean.slo <- filter(pivot_hospitalization.mean.EU,Country == "Slovenia")

p <- ggplot(pivot_hospitalization.mean.slo,aes(x=Date,y=Value)) +
  geom_line(aes(color=Variable), size=1) +
  scale_color_brewer(palette = "Set1") +
  theme(legend.title = element_text(size = 6),legend.text = element_text(size = 6),  
  panel.background = element_blank(),
  axis.line = element_line(colour = "grey"))+
  scale_y_sqrt()+
  ggtitle(label = "Hospitalisation numbers in Slovenia")+
  scale_x_date(date_labels = "%B-%d", date_breaks = "5 week")+
  ylab("Mean")+
  labs(caption="Data source: ")

ggplotly(p)
```

### Austria

```{r,echo=FALSE,message=FALSE,warning=FALSE,error=FALSE,fig.show='asis'}
#Austria
pivot_hospitalization.mean.at <- filter(pivot_hospitalization.mean.EU,Country == "Austria")

p <- ggplot(pivot_hospitalization.mean.at,aes(x=Date,y=Value)) +
  geom_line(aes(color=Variable), size=1) +
  scale_color_brewer(palette = "Set1") +
  theme(legend.title = element_text(size = 6),legend.text = element_text(size = 6),  
  panel.background = element_blank(),
  axis.line = element_line(colour = "grey"))+
  scale_y_sqrt()+
  ggtitle(label = "Hospitalisation numbers in Austria")+
  scale_x_date(date_labels = "%B-%d", date_breaks = "5 week")+
  ylab("Mean")+
  labs(caption="Data source: ")

ggplotly(p)
```

